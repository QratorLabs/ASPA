<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC4271 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml">
<!ENTITY RFC4486 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4486.xml">
<!ENTITY RFC5226 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml">
<!ENTITY RFC5492 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5492.xml">
]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<rfc category="std" docName="draft-azimov-idr-aspa-validation" ipr="trust200902">
 <front>

   <title abbrev="ASPA Validation"> Validation of AS_PATH Using the Resource Certificate Public Key Infrastructure (PKI) and
                   Austonomous System Provider Authorization (ASPA) </title>

   <author fullname="Alexander Azimov" initials="A"
           surname="Azimov">
     <organization>Qrator Labs</organization>
     <address>
       <email>aa@qrator.net</email>
     </address>
   </author>

   <author fullname="Randy Bush" initials="R"
           surname="Bush">
     <organization>Internet Initiative Japan</organization>
     <address>
       <email>randy@psg.com</email>
     </address>
   </author>

   <author fullname="Keyur Patel" initials="K"
           surname="Patel">
     <organization>Arrcus, Inc.</organization>
     <address>
       <email>keyur@arrcus.com</email>
     </address>
   </author>

   <author fullname="Job Snijders" initials="J"
           surname="Snijders">
     <organization>NTT</organization>
     <address>
       <email>job@ntt.net</email>
     </address>
   </author>

   <date month="March" year="2018"/>

   <keyword>BGP</keyword>
   <keyword>Route leak</keyword>
   <keyword>Hijacks</keyword>

   <abstract>
     <t>
         This document defines the semantics of a Autonomous System Provider Authorzation (ASPA) in terms of the
         context of an application of the Resource Public Key Infrastructure to validate the AS_PATH attribute of
         routes advertised in the Border Gateway Protocol.
     </t>
   </abstract>

   <note title="Requirements Language">
     <t>
       The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
       "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" are to be
       interpreted as described in <xref target="RFC2119">RFC 2119</xref>
       only when they appear in all upper case.  They may also appear in lower
       or mixed case as English words, without normative meaning.
     </t>
   </note>
 </front>

<middle>

    <section title="Introduction" anchor="intro">
        <t>
	    The Border Gateway Protocol (BGP) was designed with no mechanisms to guarantee the validity of BGP attributes.  Two
            results of this limitation are BGP Hijacks and BGP Route Leaks [#link]. BGP extensions are able to
            partially solve these problems. For example, RPKI can be used to detect and filter accidental mis-originations,
            and [link to open policy/eOTC] can be used to detect accidental route leaks [#link]. While these upgrades to BGP
            are quite useful, they still rely on BGP transitive attributes, especially AS_PATH, that can still be manipulated by attackers.
        </t>
        <t>
            It is believed that BGPSec [#link] can solve the problem of AS_PATH correctness. But even ignoring the
            complexity of this BGP extension, it has backward support for 'old' BGP4 that an attacker can abuse to nullify all the work of
            AS_PATH signing.  As a result, to abuse AS_PATH or any other transit attribute, an attacker merely needs to
            use 'old' BGP4.
        </t>
        <t>
            This document defines the semantics of Autonomous System Provider Authorization (ASPA) 
            using the Resource Public Key Infrastructure (RPKI) to validate the AS_PATH attribute of
            routes advertised in BGP.  It specifies AS_PATH validation procedures
            which allow a BGP listener to detect and mitigate malicious hijacks and route leaks.
        </t>

    </section>

    <section title="Autonomous System Provider Authorization" anchor="ASPA">
        <t>
           As described in [RFC6480], the RPKI is based on a hierarchy of resource certificates that are aligned to the Internet Number
           Resource allocation structure. Resource certificates are X.509 certificates that conform to the PKIX
           profile [RFC5280], and to the extensions for IP addresses and AS identifiers [RFC3779]. A resource
           certificate describes an action by an issuer that binds a list of IP address blocks and Autonomous System
           (AS) numbers to the subject of a certificate, identified by the unique association of the subject's
           private key with the public key contained in the resource certificate.  The RPKI is structured such that
           each current resource certificate matches a current resource allocation or assignment.
        </t>

        <t>
           ASPAs are digitally signed objects that bind a provider AS number to a customer (in terms of BGP announcements not business) AS number, and are signed by
           the holder of the customer AS. Thus ASPA provides verification that an AS holder has authorized a
           particular provider AS to propagate its announcements onward, e.g. to  upstream providers or peers.
           ASPAs are described in [#link]. ASPAs are intended to fit within the requirements for adding security to
           inter-domain routing and provide a mechanism to detect and filter malicious hijacks and route leaks.
        </t>

    </section>
    
    <section title="Malicious Hijacks and Route Lekas" anchor="malicious">
        <t>
            #DESCRIPTION
        </t>
    </section>

    <section title="Customer-Provider Validation Procedure" anchor="pair-validation">
        <t>
            It is assumed here that a relying party (RP) has access to a local cache of the complete set of cryptographically valid
            ASPAs when performing validation of a received AS_PATH. The RP needs to match an AS_PATH to one or more valid ASPAs
            in order to determine the validation outcome, which, in turn, can be used to determine the appropriate
            local actions to take on the received route.
        </t>


        <t> For each pair of ASs in a received AS_PATH (AS1, AS2), the customer-provider validity state is determined as follows:
            <list style="numbers">
                <t>
                    Select all cryptographically valid ASPAs with a customer value of AS2. This selection forms the set of "candidate
                    ASPAs".
                </t>
                <t>
                    If the set of candidate ASPAs is empty, then the procedure stops with an outcome of "unknown"
                    (analogous to "not found", as used in RPKI-based Origin Validation [BGP-PFX]).
                </t>
                <t>
                    If there are ASPAs in the list of candidate ASPAs where the provider field is AS1, then the
                    procedure halts with an outcome of "valid".
                </t>
                <t>
                    Otherwise, the procedure halts with an outcome of "invalid".
                </t>
            </list>
            
        </t>
    </section>
    
    <section title="AS_PATH Validation">
        <t>
            The AS_PATH attribute identifies the autonomous systems through which routing information in
            UPDATE message has passed. The components of this list can be AS_SETs or AS_SEQes, as defined in
            [RFC4271]. When a route is received from a customer or a literal peer, it SHOULD have in its AS_SEQ
            components only customer-provider pairs. If it has other types of pairs, it means that the route was
            leaked or the AS_PATH attribute was malformed. In this case, the route should be dropped. It's also important
            to highlight that routes that have AS_SET components in the AS_PATH can't be fully validated and should be
            treated with caution.
        </t>

        <t> If a route is received from a customer or peer, its AS_PATH MUST be validated as follows:
            <list style="numbers">
                <t>
                    If the left ASN in AS_PATH isn't equal to it's neighbor ASN, the route SHOULD be dropped.
                </t>
                <t>
                    If the AS_PATH has one or more invalid ASN pairs per above, it SHOULD be dropped;
                </t>
                <t>
                    If the AS_PATH has at least one AS_SET, set LOCAL_PREF to pref_set;
                </t>
                <t>
                    If the AS_PATH has no AS_SETs but has at least one pair of ASNs for which there is no corresponding ASBA,
                    set LOCAL_REF to pref_unknown;
                </t>
                <t>
                    Otherwise - set LOCAL_PREF to pref_valid.
                </t>
            </list>
            These local preference values MUST have the ordering: pref_set &lt; pref_unknown &lt;= pref_valid.
        </t>
    </section>

    <section title="Disavowal of Provider Authorizaion">
        <t>
            A ASPA is a positive attestation that a ASN holder has authorized its provider to redistribute received
            routes to its providers and peers.  This does not preclude the provider AS from redistribution to its other customers.  By creating an ASPA where the provider AS is 0, the customer indicates that no provider should further announce its routes.  Specifically, AS 0 is reserved by the
            IANA to identify Tier-1 networks and Internet exchange meshes.
        </t>

        <t>
            A ASPA with a provider AS of 0 is an statement by the customer AS that the its routes
            should not be received by any relying party AS from any of its customers or peers.
        </t>
        <t>
            By convention, an ASPA with a provider AS of 0 should be the only ASPA issued by a given AS holder; although
            this is not a strict requirement.  A provider 0 ASPA may coexist with ASPAs that have different 
            provider AS  values; though in such cases, the presence or absence of the provider AS 0 ASPA does
            not alter the AS_PATH validity state.
        </t>
    </section>

   <section anchor="IANA" title="IANA Considerations">
   </section>

   <section anchor="Security" title="Security Considerations">
   </section>

   <section anchor="Acknowledgments" title="Acknowledgments">
       <t>
           Thank all authors of  Validation of Route Origination Using
      the Resource Certificate Public Key Infrastructure (PKI) and
                   Route Origin Authorizations (ROAs) for text donation.
       </t>
   </section>

</middle>

 <back>
   <references title="Normative References">
     &RFC2119;
     &RFC4271;
     &RFC4486;
     &RFC5492;
   </references>

   <references title="Informative References">
     &RFC5226;
  </references>
 </back>
</rfc>


